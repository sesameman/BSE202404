timetest = time()
# 计算
# i & s 代表外动量 k2
# j & m 代表内动量 q2

Threads.@threads for i = 1:length(meshk)
    k2 = meshk[i]+0.0*im
    for s = 1:length(meshz)
        zk = meshz[s]+0.0*im
        for j = 1:length(meshk)
            q2 = meshk[j]+0.0*im
            for m = 1:length(meshz)
                zq = meshz[m]+0.0*im
                weightzq = weightz[m]+0.0*im
                weightq2 = weightk[j]+0.0*im
                A1in = AA((P2/4+meshk[j]+safe_sqrt(P2*meshk[j])*meshz[m]))
                A2in = AA((P2/4+meshk[j]-safe_sqrt(P2*meshk[j])*meshz[m]))
                B1in = BB((P2/4+meshk[j]+safe_sqrt(P2*meshk[j])*meshz[m]))
                B2in = BB((P2/4+meshk[j]-safe_sqrt(P2*meshk[j])*meshz[m]))

                allweight = -weightzq*weightq2*q2/(16*pi^3)/((P2/4+q2+safe_sqrt(P2*q2)*zq)*A1in^2+B1in^2)/((P2/4+q2-safe_sqrt(P2*q2)*zq)*A2in^2+B2in^2)*z2^2

                kernel11(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*(-4*B1in*B2in + A1in*A2in*(P2 - 4*q2))
                
                kernel12(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*(-2*(A2in*B1in + A1in*B2in)*P2 + 4*(A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq)
                
                kernel13(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*(-2*safe_sqrt(P2*q2)*zq*(2*(-(A2in*B1in) + A1in*B2in)*q2 + (A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq))
                
                kernel14(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*(-4*A1in*A2in*(-(P2*q2) + P2*q2*zq^2))
                
                kernel21(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((2*(k2^2*((A2in*B1in + A1in*B2in)*P2 + 2*(-(A2in*B1in) + A1in*B2in)*safe_sqrt(P2*q2)*zq) + k2*(-((A2in*B1in + A1in*B2in)*k2*P2*zk^2) + 2*(A2in*B1in + A1in*B2in)*P2*q2*zq^2 + q2*((A2in*B1in + A1in*B2in)*P2 + 6*(-(A2in*B1in) + A1in*B2in)*safe_sqrt(P2*q2)*zq) + 2*safe_sqrt(k2)*safe_sqrt(q2)*(-((A2in*B1in + A1in*B2in)*P2) + 4*(A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) + 2*safe_sqrt(k2*P2)*zk*(-((A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq) + (A2in*B1in - A1in*B2in)*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + safe_sqrt(k2*P2)*zk*((A2in*B1in + A1in*B2in)*safe_sqrt(k2*P2)*zk*(-q2 + 4*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(3*(-(A2in*B1in) + A1in*B2in)*q2 + (A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq + 4*(A2in*B1in - A1in*B2in)*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel22(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((k2^2*(A1in*A2in*P2^2 + P2*(-4*B1in*B2in + 4*A1in*A2in*q2) - 8*A1in*A2in*P2*q2*zq^2) + safe_sqrt(k2*P2)*zk*(safe_sqrt(k2*P2)*(-4*B1in*B2in + A1in*A2in*(P2 + 4*q2))*zk*(-q2 + 4*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) - 2*safe_sqrt(k2)*safe_sqrt(q2)*safe_sqrt(P2*q2)*zq*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(-4*B1in*B2in + A1in*A2in*(P2 - 8*q2 + 16*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))) + k2*(4*A1in*A2in*P2*q2^2 + k2*P2*(4*B1in*B2in - A1in*A2in*(P2 + 4*q2))*zk^2 - 2*safe_sqrt(k2)*P2*(-4*B1in*B2in + A1in*A2in*P2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) + 2*safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq*(4*B1in*B2in + A1in*A2in*(-P2 - 4*q2 + 4*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + 2*P2*q2*zq^2*(-4*B1in*B2in + A1in*A2in*(P2 + 16*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + q2*(-16*A1in*A2in*P2*q2*zq^2 + P2*(-4*B1in*B2in + A1in*A2in*(P2 - 8*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel23(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((safe_sqrt(P2*q2)*zq*(k2^2*(-4*B1in*B2in + A1in*A2in*(P2 - 4*q2))*safe_sqrt(P2*q2)*zq + safe_sqrt(k2*P2)*zk*(-2*A1in*A2in*safe_sqrt(k2*P2)*q2*safe_sqrt(P2*q2)*zk*zq - 4*k2*q2*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))^2 + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(12*B1in*B2in*q2 + A1in*A2in*(3*q2*(P2 + 4*q2) + 8*safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq - 4*P2*q2*zq^2))) + k2*(-2*A1in*A2in*k2*P2*safe_sqrt(P2*q2)*zk^2*zq + safe_sqrt(P2*q2)*zq*(-(q2*(12*B1in*B2in + A1in*A2in*(P2 + 12*q2))) + 4*A1in*A2in*P2*q2*zq^2 + 16*safe_sqrt(k2)*safe_sqrt(q2)*(B1in*B2in + A1in*A2in*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + safe_sqrt(k2*P2)*zk*(-4*A1in*A2in*P2*q2*zq^2 + safe_sqrt(k2)*safe_sqrt(q2)*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel24(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((2*(-2*(A2in*B1in + A1in*B2in)*k2^2*(-(P2*q2) + P2*q2*zq^2) + safe_sqrt(k2*P2)*zk*(safe_sqrt(k2*P2)*q2*zk*(-2*(A2in*B1in + A1in*B2in)*q2 + (A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq) + safe_sqrt(k2)*safe_sqrt(q2)*(-2*(A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq*(2*safe_sqrt(k2*P2)*zk - safe_sqrt(P2*q2)*zq) + q2*(3*(-(A2in*B1in) + A1in*B2in)*P2 + 8*(A2in*B1in + A1in*B2in)*safe_sqrt(k2*P2)*zk + 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) + 4*k2*q2*((A2in*B1in - A1in*B2in)*P2 - 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))^2) + k2*(k2*P2*zk^2*(-2*(A2in*B1in + A1in*B2in)*q2 + (A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq) - 2*((A2in*B1in + A1in*B2in)*q2 + (A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq)*(-(P2*q2) + P2*q2*zq^2) + 2*safe_sqrt(k2)*safe_sqrt(q2)*(4*(A2in*B1in + A1in*B2in)*P2*q2*zq^2 + P2*(-2*(A2in*B1in + A1in*B2in)*q2 + (-(A2in*B1in) + A1in*B2in)*safe_sqrt(P2*q2)*zq))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) + safe_sqrt(k2*P2)*zk*(2*safe_sqrt(P2*q2)*zq*(-2*(A2in*B1in + A1in*B2in)*q2 + (A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq) + safe_sqrt(k2)*safe_sqrt(q2)*((-(A2in*B1in) + A1in*B2in)*P2 + 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel31(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((-4*((A2in*B1in + A1in*B2in)*(k2*P2)^1.5*zk^3 - 2*k2*P2*zk^2*((-(A2in*B1in) + A1in*B2in)*q2 + (A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq + (A2in*B1in - A1in*B2in)*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + safe_sqrt(k2*P2)*zk*(-(k2*((A2in*B1in + A1in*B2in)*P2 + (A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq)) + safe_sqrt(P2*q2)*zq*(3*(-(A2in*B1in) + A1in*B2in)*q2 + (A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq) + safe_sqrt(k2)*safe_sqrt(q2)*((A2in*B1in + A1in*B2in)*P2 + 4*(A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + P2*(k2*(2*(-(A2in*B1in) + A1in*B2in)*q2 + (A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq + 3*(A2in*B1in - A1in*B2in)*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) - safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(3*(-(A2in*B1in) + A1in*B2in)*q2 + (A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq + 4*(A2in*B1in - A1in*B2in)*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *safe_sqrt(k2*P2)*zk*(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel32(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((2*((k2*P2)^1.5*(4*B1in*B2in - A1in*A2in*(P2 + 4*q2))*zk^3 + safe_sqrt(k2*P2)*zk*(P2*(4*B1in*B2in - A1in*A2in*(P2 - 8*q2))*q2*zq^2 + k2*(A1in*A2in*P2^2 + P2*(-4*B1in*B2in + 4*A1in*A2in*q2) + 4*A1in*A2in*P2*q2*zq^2) + safe_sqrt(k2)*safe_sqrt(q2)*(-(A1in*A2in*P2^2) + 4*P2*(B1in*B2in - A1in*A2in*q2) - 16*A1in*A2in*P2*q2*zq^2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + 2*k2*P2*safe_sqrt(P2*q2)*zk^2*zq*(-4*B1in*B2in + A1in*A2in*(P2 + 4*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + P2*safe_sqrt(P2*q2)*zq*(k2*(4*B1in*B2in - A1in*A2in*(P2 - 4*q2 + 12*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(-4*B1in*B2in + A1in*A2in*(P2 - 8*q2 + 16*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))))/(3. *safe_sqrt(k2*P2)*zk*(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel33(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((safe_sqrt(P2*q2)*zq*(-4*A1in*A2in*(k2*P2)^1.5*safe_sqrt(P2*q2)*zk^3*zq + safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq*(12*B1in*B2in*q2 + k2*(4*B1in*B2in + A1in*A2in*(5*P2 + 4*q2)) + A1in*A2in*(3*q2*(P2 + 4*q2) - 4*P2*q2*zq^2) - 8*safe_sqrt(k2)*safe_sqrt(q2)*(2*B1in*B2in + A1in*A2in*(P2 + 2*q2))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + 2*k2*P2*zk^2*(-(q2*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2))) + 4*A1in*A2in*P2*q2*zq^2 + safe_sqrt(k2)*safe_sqrt(q2)*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + P2*(k2*(2*q2*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2)) - 4*A1in*A2in*P2*q2*zq^2 - 3*safe_sqrt(k2)*safe_sqrt(q2)*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(-3*q2*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2)) + 4*A1in*A2in*P2*q2*zq^2 + 4*safe_sqrt(k2)*safe_sqrt(q2)*(4*B1in*B2in + A1in*A2in*(P2 + 4*q2))*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *safe_sqrt(k2*P2)*zk*(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel34(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((4*(k2*P2)^1.5*zk^3*(-2*(A2in*B1in + A1in*B2in)*q2 + (A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq) + 4*k2*P2*zk^2*(2*(-(A2in*B1in) + A1in*B2in)*P2*q2*zq^2 + q2*((A2in*B1in - A1in*B2in)*P2 + 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq) + safe_sqrt(k2)*safe_sqrt(q2)*((-(A2in*B1in) + A1in*B2in)*P2 + 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + 2*P2*(k2*(2*(A2in*B1in - A1in*B2in)*(-(P2*q2) + P2*q2*zq^2) + 3*safe_sqrt(k2)*safe_sqrt(q2)*((A2in*B1in - A1in*B2in)*P2 - 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))*(2*(-(A2in*B1in) + A1in*B2in)*P2*q2*zq^2 + q2*(3*(A2in*B1in - A1in*B2in)*P2 - 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq) + 4*safe_sqrt(k2)*safe_sqrt(q2)*((-(A2in*B1in) + A1in*B2in)*P2 + 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + 2*safe_sqrt(k2*P2)*zk*(safe_sqrt(P2*q2)*zq*(2*(A2in*B1in - A1in*B2in)*P2*q2*zq^2 + 2*(A2in*B1in + A1in*B2in)*safe_sqrt(P2*q2)*zq*(k2 - 4*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) - 3*(A2in*B1in - A1in*B2in)*P2*(k2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))) + q2*(3*(-(A2in*B1in) + A1in*B2in)*P2*safe_sqrt(P2*q2)*zq + 2*(A2in*B1in + A1in*B2in)*P2*q2*zq^2 + 4*(A2in*B1in + A1in*B2in)*P2*(k2 - safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *safe_sqrt(k2*P2)*zk*(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel41(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((4*A1in*A2in*(-2*k2*P2*q2*zk^2 - safe_sqrt(k2)*P2*q2^1.5*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) + safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq*(q2 + 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + k2*(safe_sqrt(P2*q2)*zq*(safe_sqrt(k2*P2)*zk - 2*safe_sqrt(P2*q2)*zq) - P2*(-2*q2 + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel42(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((4*(A2in*B1in + A1in*B2in)*(2*k2*P2*q2*zk^2 + safe_sqrt(k2)*P2*q2^1.5*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) - safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq*(q2 + 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + k2*(safe_sqrt(P2*q2)*zq*(-(safe_sqrt(k2*P2)*zk) + 2*safe_sqrt(P2*q2)*zq) + P2*(-2*q2 + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel43(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*((2*(A2in*B1in - A1in*B2in)*safe_sqrt(P2*q2)*zq*(2*k2*P2*q2*zk^2 + safe_sqrt(k2)*P2*q2^1.5*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) - safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq*(q2 + 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + k2*(safe_sqrt(P2*q2)*zq*(-(safe_sqrt(k2*P2)*zk) + 2*safe_sqrt(P2*q2)*zq) + P2*(-2*q2 + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel44(y) = D(k2+q2-2*safe_sqrt(k2*q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))*(((4*B1in*B2in + A1in*A2in*(P2 - 4*q2))*(2*k2*P2*q2*zk^2 + safe_sqrt(k2)*P2*q2^1.5*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)) - safe_sqrt(k2*P2)*safe_sqrt(P2*q2)*zk*zq*(q2 + 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))) + k2*(safe_sqrt(P2*q2)*zq*(-(safe_sqrt(k2*P2)*zk) + 2*safe_sqrt(P2*q2)*zq) + P2*(-2*q2 + safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2))))))/(3. *(-(k2*P2) + k2*P2*zk^2)*(k2 + q2 - 2*safe_sqrt(k2)*safe_sqrt(q2)*(zk*zq + y*safe_sqrt(1 - zk^2)*safe_sqrt(1 - zq^2)))))
                
                kernel[i,s,j,m,1,1] = allweight*gausslegendreint16(kernel11)
                kernel[i,s,j,m,1,2] = allweight*gausslegendreint16(kernel12)
                kernel[i,s,j,m,1,3] = allweight*gausslegendreint16(kernel13)
                kernel[i,s,j,m,1,4] = allweight*gausslegendreint16(kernel14)
                kernel[i,s,j,m,2,1] = allweight*gausslegendreint16(kernel21)
                kernel[i,s,j,m,2,2] = allweight*gausslegendreint16(kernel22)
                kernel[i,s,j,m,2,3] = allweight*gausslegendreint16(kernel23)
                kernel[i,s,j,m,2,4] = allweight*gausslegendreint16(kernel24)
                kernel[i,s,j,m,3,1] = allweight*gausslegendreint16(kernel31)
                kernel[i,s,j,m,3,2] = allweight*gausslegendreint16(kernel32)
                kernel[i,s,j,m,3,3] = allweight*gausslegendreint16(kernel33)
                kernel[i,s,j,m,3,4] = allweight*gausslegendreint16(kernel34)
                kernel[i,s,j,m,4,1] = allweight*gausslegendreint16(kernel41)
                kernel[i,s,j,m,4,2] = allweight*gausslegendreint16(kernel42)
                kernel[i,s,j,m,4,3] = allweight*gausslegendreint16(kernel43)
                kernel[i,s,j,m,4,4] = allweight*gausslegendreint16(kernel44)
            end
        end
    end
end
